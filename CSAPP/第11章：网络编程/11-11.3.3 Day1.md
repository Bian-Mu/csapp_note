### 客户端-服务器模型
所有网络应用都基于该模型，实现一对多的资源服务交互

该模型中最基本的操作是**事务**：
1. 客户端向服务器发起请求，要求一件事务
2. 服务器接收到请求，解析该请求，适当操作资源
3. 服务器向客户端发送响应，并等待下一个请求
4. 客户端收到响应并处理它
![[0ff49105231c34d64ef8be36e96532f5.png]]**客户端和服务器都是进程**，而不是指主机。

### 网络
这些进程运行在不同的主机上，并且通过计算机网络的硬件和软件资源来通信。
![[37fb5813c56f667bf9b2087c7e275e18.png]]
- 对主机而言，网络是一种I/O设备
- 网络中的数据从适配器经过两条总线复制到主存，一般通过DMA传送

#### 网络的物理解释
网络是一个按照地理远近的层次系统。
1. LAN（局域网）：最低层，一般通过以太网（Ethernet）实现
	![[099fe0741faebb1cd192ba8f69911597.png]]
	- 主机的**适配器**接入集线器的一个**端口**，这个端口接收到的位会被复制到所有端口上，因此每个主机都可以看到所有位
	- 每个适配器都有全球唯一的48位地址，存储在非易失性存储器上。主机可以发送由**一段位组成的帧**到这个以太网段内的任何主机。这个帧被所有主机看到、但只有目的主机可以读取。帧中存储着头部位（源和目的的物理地址、帧长度）、数据位
	![[6111b39fb2a0996e25c78aafcbf61cdc.png]]
	- 多个以太网段可以借助网桥连接成一个较大的以太网
	- 电缆之间的带宽可以不同。网桥利用分配算法，在复制帧时，只贯通必要的路径，从而节省带宽
2. WAN（广域网）：多个不兼容的LAN通过路由器连接成互联网络，每台路由器对于它连接的每个LAN都有一个适配器（端口）
	![[deac5ed00ccfc559c1e85e89d76eedf0.png]]

#### 互联网络
1. 由采用完全不同的和不兼容技术的各种局域网和广域网组成。
2. 每台主机之间物理相连，通过协议软件实现跨不兼容网络发送数据位。

协议软件：控制主机和路由器协同工作实现数据传输，协议有两种基本功能：
1. **命名机制**：不同的局域网技术有不同和不兼容的方式来为主机分配地址。*协议通过一种一致的主机地址格式消除了这些差异。每台主机会至少被分配一个**互联网络地址**，作为唯一标识*
2. **传送机制**：在电缆上编码位和这些要传输的数据位被封装成帧方面，不同联网技术方式不兼容。*协议通过定义一种把数据位捆扎成不连续的片（称为包）的方式，消除了不兼容*。包是由包头和有效载荷组成的，包头包含包的大小、源主机以及目的主机的IP地址；有效载荷包括从源主机发出的数据位

主机和路由器依靠协议在不兼容的局域网之间传送数据：
（从LAN1的主机A发送数据到LAN2的服务端）
![[1333f7d6217ff0ffe7eda01cc1ec697f.png]]
![[04ddaa012ade1e52e94a16a6ac18cb72.png]]![[81599af0ce9116f8983acbb08034e454.png]]

### 全球IP因特网
![[2daf9e365e90db5c6d555fafa1db915f.png]]
- 每台加入因特网的主机都运行着TCP/IP协议（传输控制/互联网络协议）软件。
- 因特网的客户端和服务器混合使用套接字接口函数以及Unix I/O函数进行通信。套接字函数将被实现成系统调用，从而在内核模式下调用TCP/IP函数

因特网可以看作是全球范围的主机集合：
- 主机集合映射为一组32位的IP地址
- 这组IP地址映射为一组称为因特网域名的标识符
- 因特网主机上的进程可以通过连接，实现和其他主机上的进程的通信
![[4ec689cb25b3f5ed5825600efa2e2ed2.png]]
#### TCP/IP协议族
1. IP协议：提供命名方法和传送机制，由一台主机向其他主机发送包，也成为数据报。
	- 某种意义上是不可靠的，丢包、重复发包后并不会试图恢复
2. UDP（不可靠数据报）协议：扩展了IP协议，允许包在进程间双向传送

#### IP地址
- 一个32位的无符号整数，网络程序将IP地址存在一个结构中
![[e51f51c3070dc6714e0af1d3bf208e3c.png]]

因特网主机可以有不同的主机字节顺序，所以要定义统一的“网络字节顺序”（大端）
`htonl()、htons()函数`：
![[3050808ba1d5764b01e485ef01e841d2.png]]![[30de702bd552261961bbef91b03fdf36.png]]

IP地址通过“点分十进制”来表示：每个字节由它的十进制表示，以点隔开。
`128.2.194.242=0x8002c2f2`
`inet_pton()、inet_ntop()函数`：
![[f2a40d01bf51bb5d52c7d411479f669d.png]]
#### 因特网域名
在因特网中，客户端和服务器通信使用的是IP地址。为了便于记忆，使用域名来映射IP地址

域名是一个层次结构（可以表示为树），每个域名编码了它在层次中的位置。
![[e3a1128e9b142f1196d6a0f84574c24c.png]]
第0层：未命名的根
第1层：一级域名，由ICANN组织定义，上图是常见的一级域名
第2层：二级域名，链接顺序为`cmu.edu`，由ICANN的各个授权代理按照先到达先服务的基础进行分配，二级域名可以创建自己的子域名，例如`cs.cmu.edu`

域名集合与IP地址的映射由世界范围的数据库**DNS**（domain name system）维护，由上百万条主机条目结构组成，每个条目定义了一组IP与一组域名的映射

借助`nslookup`程序查询域名与IP的映射关系
![[cf1729486361d1bc2addfd14d8e1bc87.png]]
#### 因特网连接
客户端和服务器通过“连接”来发送和接收通信。

一个套接字是连接的一个端点。每个套接字有相应的套接字地址，是由一个因特网地址和16位的整数端口组成的，用“地址：端口”表示

套接字地址端口：
1. 客户端发起连接请求时，客户端套接字地址中的端口由内核自动分配，成为临时端口；
2. 服务器套接字地址中的端口为知名端口，与该服务相对应，例如
	```知名端口80=Web服务=http  知名端口25=email=smtp```
	- 该映射关系存在`/etc/services`中

所以一个连接应该是建立在两个端口之间的，故**连接由两端的套接字地址来确定**，这对地址称为“套接字对”，表示为下列元组：`(cli_ipaddr:cli_port, serv_ipaddr:serv_port)`
![[4321e1790ff4895c01b78ea87e532fdd.png]]
- 临时端口：51213    知名端口：80

