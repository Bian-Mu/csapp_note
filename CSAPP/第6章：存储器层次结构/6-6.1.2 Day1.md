### 存储器系统
之前的简单模型：“存储器是一个线性的字节数组，cpu在常数时间内访问每个存储器位置”

实际上：
1. 具有不同容量、成本和访问时间的存储设备的多层次结构
2. cpu中保存着最常用的数据。
3. 靠近CPU的小型快速的**cache memory**充当缓冲区，用于存储相对较慢的**main memory**中的部分数据和指令。
4. **main memory**则作为大型慢速磁盘上数据的缓冲区，而这些磁盘又通常作为通过网络连接的其他机器上磁盘或磁带存储数据的缓冲区。

> 分层次的可行性：
> 	 大部分程序只频繁访问一个层的存储设备，或者是附近层（局部性）；
> 	 可以达成最底层成本很低但由于多层结构，最终向顶层传输时速率差别不大
> 	 
> ![[cc29685641ad3163e84c37acb58feca8.png]]

### 存储技术

#### 随机访问存储器（RAM）
##### SRAM(static)
- 将每个位都存储在一个双稳态的存储器单元里。该单元的电路可以无期限的保持在两个不同的电压状态之一，如果变成不稳定状态则会立刻变动。
![[7bc2c5f148412b6d5b7229bf688c454b.png]]
##### DRAM(dynamic)
- 每个位存储成一个电容的充电（该电容非常小），由一个晶体管访问。由于对干扰非常敏感（所以是dynamic），当电容电压被扰乱后就不会恢复了。
- 很多原因会导致漏电，但时钟周期比漏电速率小很多
- 内存系统会周期性的读出，并通过重写来刷新内存的每一位；部分系统会给每个字增加纠错码来校验
![[e369ab244cb6b1765b7faa18d5171574.png]]

##### 传统的DRAM
![[c2657a5edb60968ea40248263ed1be66.png]]![[231f8a6229ddb84051ebe07ca540f3c2.png]]
![[ef20564d7b7f58d55f6d6b71cdc07f8c.png]]

##### 内存模块
DRAM芯片封装在内存模块里，插在主板的扩展槽上
![[60047352ace93e2053d3cdf8e164b655.png]]![[e4c6b795c0a1a1d8d1935a3dddfcc39c.png]]

##### 增强的DRAM
1. 快页模式（FPM DRAM）：允许对同一行连续访问，可以直接从行缓冲区得到多个超单元
2. 扩展数据输出（EDO DRAM）：比上一个在CAS信号的时间上更紧密
3. 同步（SDRAM）：常规的DRAM与内存控制器通信时使用一组显示的控制信号，而SDRAM用与驱动内存控制器相同的外部时钟信号来代替大部分控制信号，达成同步
4. 双倍速率（DDR DRAM）：使用两个时钟作为控制信号
5. 视频（VRAM）：用在图形系统的帧缓冲区中，输出由对内部缓冲区整个内容的移位得到，且允许并行的读写内存。所以可以在下一次更新的时候用帧缓冲区的像素刷新屏幕

##### 非易失性存储器
- 如果断电，SRAM和DRAM会丢失信息，是易失的。
**只读存储器ROM实际上有些类型可以读也可以写**，以其能被重编程（写）的次数和重编程（写）所用机制来分类的。

1. PROM：只能被编程一次，每个存储器单元有一种高电流熔断丝
2. 可擦写可编程（EPROM）：紫外线光照射时，单元清除为0,需要特殊工具编程，电子化的EEPROM需要用印制电路上编程
3. 闪存（flash memory）：基于EEPROM，大量使用，例如固态硬盘（SSD）

存储在ROM中的程序称为固件。当计算机通电时，会运行ROM中的固件。
- 一些固件中有少量输入输出函数，如PC的BIOS（基本输入输出系统）例程
- 复杂设备，如磁盘驱动控制器，也以来固件翻译CPU的IO请求

##### 访问主存
数据流通过总线（bus）这一共享电子电路在处理器和DRAM主存之间来回。每次数据传送通过的一系列步骤称为总线事务，分为：
- 读事务：从主存到CPU
- 写事务：从CPU到主存
![[9a5478663edddb2fb47cee9502741233.png]]

1. 读事务的流程：
![[08ada8f8a27557615bd49424ef5da0a4.png]]
2. 写事务的流程：
![[4d92a5228436a6acfa9a47229145337a.png]]

#### 磁盘存储
##### 磁盘构造
![[1460324147cc2ce0aa2aca2f9542c315.png]]
- 磁盘由多个盘片叠放而成，每个盘片都有两面（表面），绕主轴旋转，每个表面是一组称为磁道的同心圆。
- 每个磁道被划分为一组扇区，其中包含等量的数据位（通常是512字节）。
- 数据位编码在扇区上的磁性材料中，扇区之间有间隙隔开，间隙存储用来标识扇区的格式化位。
- 上图整个装置被称为磁盘驱动器

##### 磁盘容量
可以记录的最大位数

受到以下因素影响：
1. 记录密度：单位英寸可以容纳的位数
2. 磁道密度：从圆心出发每英寸的磁道数
3. 面密度：上述二者乘积

